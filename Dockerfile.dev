# Development Dockerfile with live reload using CompileDaemon
FROM golang:1.23-alpine

# Install CompileDaemon for live reload and git for dependencies
RUN apk add --no-cache git && \
    go install github.com/githubnemo/CompileDaemon@latest

# Set working directory
WORKDIR /app

# Copy go mod and sum files first for better caching
COPY go.mod go.sum ./

# Download dependencies
RUN go mod download

# Copy source code
COPY . .

# Create tmp directory for builds
RUN mkdir -p tmp

# Expose port
EXPOSE 8080

# Command to run with live reload (will be overridden in docker-compose)
CMD ["CompileDaemon", "-build=\"go build -o ./tmp/main ./cmd/server\"", "-command=\"./tmp/main\""]